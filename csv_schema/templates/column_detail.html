{% extends "base_templates/base.html" %}
{% block contents %}
<div class="container main-content">
  <div class="row">
    <div class="col-md-12">
      <div class="row">
        <div class="col-md-12">
          <a class="ncdr-breadcrumbs" href="{{ settings.SITE_PREFIX }}{% url 'database_list' %}">Home</a><a class="ncdr-breadcrumbs" href="{{ settings.SITE_PREFIX }}{% url 'column_redirect' %}">Columns</a><a class="ncdr-breadcrumbs" href="{{ object.get_bread_crumb_link }}"> {{ object.get_bread_crumb_name }}</a>{{ object.name }}
        </div>
      </div>

      <div class="row content-offset-below-20">
        {# this needs to be changed to 10 when moving to settings.USE_GROUPINGS = False #}
        <div class="col-sm-12">
          <h1>
            <div class="row">
              <div class="col-md-12">
                {{ object.name }}
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <small>
                  {{ object.table.database.get_display_name }} / {{ object.table.name }}
                </small>
              </div>
            </div>
          </h1>
        </div>
        {% if object.grouping %}
        <div class="col-sm-2 text-right">
          <div style="margin-top: 25px">
              <a href="{{ object.grouping.get_absolute_url }}" class="label label-default">{{ object.grouping }}</a>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="row nhs-england-well">
    <div class="col-md-7">
      <p>
        {{ object.description | urlize }}
      </p>
    </div>
    <div class="col-md-4 col-md-push-1">
      <div class="row">
        {% if object.link %}
          <div class="col-md-12">
              <h4 class="sub-row-title coloured-header">External Links</h4>
              <p>
                <a target="_blank" href="{{ object.link }}">
                  {{ object.link_display_name }}
                </a>
              </p>
          </div>
        {% endif %}
      </div>
      {% if object.link and object.is_derived_item %}
        <div class="row">
          <div class="col-md-12">
            <hr />
          </div>
        </div>
      {% endif %}
      <div class="row">
        <div class="col-md-12">
          {% if object.is_derived_item %}
            <h4 class="sub-row-title coloured-header">Derivation</h4>
            {% if object.derivation == 'N/A' %}
              External
            {% else %}
              {{ object.derivation | urlize }}
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container">
  <div class="row">
    <div class="col-md-8">
      {% for table, columns in object.related %}
        {% ifchanged table.database.name %}
          <div class="row">
            <div class="col-md-12">
              <h3 class="sub-row-title">Used in the {{ table.database.get_display_name }}:</h3>
            </div>
          </div>
        {% endifchanged %}
        <div class="row">
          <div class="col-md-12">
            <h4>
              <a href="{{ table.get_absolute_url }}">
                {{ table.name }}
              </a>
            </h4>
            {% if table.description %}
              <div class="row">
                <div class="col-md-12">
                  <p>
                    {{ table.description }}
                  </p>
                </div>
              </div>
            {% endif %}
            {% if columns|length > 1 or object not in columns %}
              <div class="row">
                <div class="col-md-12">
                  As {% for column in columns %}{% if not forloop.first %}{% if forloop.last %} & {% else %}, {% endif %}{% endif %}{{ column }}{% endfor %}
                </div>
              </div>
            {% endif %}
          </div>
        </div>
        {% if not forloop.last %}
          <hr />
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
