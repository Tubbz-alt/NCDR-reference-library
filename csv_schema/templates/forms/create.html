{% extends "base_templates/form_base.html" %}
{% load bootstrap %}
{% block form_title %}
  <h3>Add {{ view.model.get_model_display_name_plural }}</h3>
  {% if view.model.get_form_description_template %}
    <div class="row nhs-england-well">
      {% include view.model.get_form_description_template %}
    </div>
  {% endif %}
{% endblock %}
{% block form_contents %}
<div class="row content-offset">
  <div class="col-md-12">
    {% if formset.total_error_count %}
      <ul class="errorList">
        {% for dict in formset.errors %}
            {% for error in dict.values %}
              {% for i in error %}
                <li>{{ i }}</li>
              {% endfor %}
            {% endfor %}
        {% endfor %}
        </ul>
    {% endif %}
    <form action="" method="post">
      {% csrf_token %}
      {{ formset.management_form }}
      <div id="items-form-container">
      </div>
      <div class="row">
        <div class="col-md-12 text-right">
          <a href="" id="add-another" class="btn btn-primary">
            Add Another
          </a>
          <a href="{{ model.get_edit_list_url }}" class="btn btn-default">
            Cancel
          </a>
          <input class="btn btn-primary" type="submit" value="Submit" />
        </div>
      </div>
    </form>
  </div>

    <script type="text/html" id="record-template">
      <div id="item-__prefix__">
        {% include view.model.get_form_template with form=formset.empty_form %}
        <hr />
      </div>
    </script>
    <script>


    var addAnother = function(){
      var count = $('#items-form-container').children().length;
      var tmplMarkup = $('#record-template').html();
      var compiledTmpl = tmplMarkup.replace(/__prefix__/g, count);
      $('div#items-form-container').append(compiledTmpl);

      // update form count
      $('#id_form-TOTAL_FORMS').attr('value', count+1);
    }

    $("#add-another").click(function(e){
      e.preventDefault();
      addAnother();
    });
    addAnother();
  </script>
</div>
{% endblock %}
