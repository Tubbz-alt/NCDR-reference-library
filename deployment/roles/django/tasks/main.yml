---
# This playbook provides basic elements of a server we would like to maintain
- name: update apt-cache
  sudo: true
  apt: update_cache=yes

- name: install packages for sysadmin
  apt: pkg={{ item }} state=installed
  with_items:
    - nginx
    - postgresql
    - libpq-dev
    - python-psycopg2

- name: Ensure locale is available
  locale_gen: name=en_US.UTF-8

# - name: Ensure database is created
#   become: yes
#   become_user: postgres
#   postgresql_db: name={{ db_name }}
#                  encoding='UTF-8'
#                  lc_collate='en_US.UTF-8'
#                  lc_ctype='en_US.UTF-8'
#                  template='template0'
#                  state=present

# - name: Ensure user has access to the database
#   become: yes
#   become_user: postgres
#   postgresql_user: db={{ db_name }}
#                    name={{ db_user }}
#                    password={{ db_password }}
#                    priv=ALL
#                    state=present

- name: Ensure no existing virtualenv exists
  file:
    state: absent
    path: "{{ virtualenv_path }}/"

- name: Create the virtualenv
  shell: . /usr/share/virtualenvwrapper/virtualenvwrapper.sh && mkvirtualenv -p /usr/bin/python3 {{ application_name }}
  args:
    executable: /bin/bash
